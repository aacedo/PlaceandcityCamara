<!doctype html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Place and City</title>
    <link href="css/bootstrap.css" rel="stylesheet" type="text/css"/>
    <link href="css/styles_general.css" rel="stylesheet" type="text/css"/>
    <link href="css/styles_map2.css" rel="stylesheet" type="text/css"/>
    <link href="css/leaflet.css" rel="stylesheet" type="text/css"/>
    <link href="css/leaflet.draw.css" rel="stylesheet" type="text/css"/>
    <link href="css/bootstrap-slider.css" rel="stylesheet" type="text/css"/>

</head>

<body>
<!-- ------------------------------- Navbar --------------------------------------------------------------------------------- -->
<nav class="navbar navbar-default navbar-fixed-top">
    <div class="container-fluid">
        <div class="navbar-header name_navbar col-xs-4 col-sm-5 col-md-5 col-lg-5 visible-lg visible-md visible-sm">
            <img src="img/logo_engaging.svg" class="logo_phd">Place and City
        </div>
        <!--  Visible only xs  -->
        <div class="navbar-header name_navbar col-xs-4 col-sm-5 col-md-5 col-lg-5 visible-xs">
            <img src="img/logo_engaging.svg" class="logo_phd">
        </div>
        <ul class="nav navbar-right float-right col-lg-5 col-md-5 col-sm-5 col-xs-8" style="padding-right: 0px;">
            <li class="float-right visible-lg visible-md visible-sm links-navbar">
                <a href="#" style="margin-right:20px; padding: 0px" data-toggle="modal" data-target="#myModal3">
                    <span class="glyphicon glyphicon-info-sign btn-lg icon-navbar"></span><br>Help
                </a>
            </li>
            <!--  Visible only xs  -->
            <li class="float-right visible-xs links-navbar">
                <a href="#" style="margin-right:0px; padding: 0px" data-toggle="modal" data-target="#myModal2">
                    <span class="glyphicon glyphicon-info-sign btn-lg icon-navbar" style="padding-right: 0px"
                          id=""></span>
                </a>
            </li>
            <li class="float-right visible-lg visible-md visible-sm links-navbar">
                <a href="http://www.engagingeographies.com/blog" id="navbar_xs"
                   style="margin-right:20px; margin-left:0px; padding: 0px">
                    <span class="glyphicon glyphicon-file btn-lg icon-navbar" id=""></span><br>Blog
                </a>
            </li>
            <!--  Visible only xs  -->
            <li class="float-right visible-xs links-navbar">
                <a href="http://www.engagingeographies.com/blog" id="navbar_xs"
                   style="margin-right:0px; margin-left:0px; padding: 0px">
                    <span class="glyphicon glyphicon-file btn-lg icon-navbar" style="padding-right: 5px" id=""></span>
                </a>
            </li>
            <li class="float-right visible-lg visible-md visible-sm links-navbar">
                <a href="contact.html" style="margin-right:20px; margin-left:0px; padding: 0px">
                    <span class="glyphicon glyphicon-envelope btn-lg icon-navbar" id=""></span><br>Contact
                </a>
            </li>
            <!--  Visible only xs  -->
            <li class="float-right visible-xs links-navbar">
                <a href="contact.html" style="margin-right:0px; margin-left:0px; padding: 0px">
                    <span class="glyphicon glyphicon-envelope btn-lg icon-navbar" style="padding-right: 5px" id=""></span>
                </a>
            </li>
        </ul>
    </div>
</nav>
<!-- ------------------------------- End Navbar ----------------------------------------------------------------------------- -->
<div class="container-fluid">
    <!-- ------------------------------- Map visible lg md sm  -------------------------------------------------------------------- -->
    <div id="pepe" class="col-lg-6 col-md-6 col-sm-6 visible-lg visible-md visible-sm" style="position: fixed; right: 0px;">
        <div class="panel panel-default">
            <div class="panel-body">
                <div id="map" style="height:84vh; position: relative;">
                    <div class="visible-lg visible-md visible-sm" style="position: absolute; top: 10px; left: 65px; z-index: 998">
                        <button class="btn btn-default btn-md" id="draw_poly">
                            <span class="glyphicon glyphicon-pencil" aria-hidden="true" style="margin-right: 5px"></span> Start drawing
                        </button>
                        <button class="btn btn-default btn-md" id="delete_poly">
                            <span class="glyphicon glyphicon-trash" aria-hidden="true" style="margin-right: 5px"></span>
                            Delete area
                        </button>
                    </div>
                    <!-- <div class="custom_buttons_leaflet visible-lg visible-md visible-sm">
                        <button class="btn btn-default btn-md" id="draw_poly" onclick="drawPolygon()" disabled>
                            <span class="glyphicon glyphicon-pencil" aria-hidden="true" style="margin-right: 5px"></span>
                            Start drawing
                        </button>
                        <button class="btn btn-default btn-md" id="delete_poly">
                            <span class="glyphicon glyphicon-trash" aria-hidden="true" style="margin-right: 5px"></span>
                            Delete area
                        </button>
                    </div>
                    <div id="map" style="height:84vh"></div> -->
                    <!-- <div class="col-xs-12 col-md-12 col-lg-12 col-sm-12" style="text-align: right;"> -->
                    <!--<a type="button" class="btn btn-primary finish-map pop" data-toggle="popover" data-placement="top"-->
                    <!--title="Before finish" data-content="Areas that have drawn, chooses the most important to you."-->
                    <!--onclick="toggler('secondimage');" disabled>Next</a>-->
                    <!--GERMAN-->
                    <a type="button" id="questions-ce" class="btn btn-primary finish-map pop" disabled>Next</a>
                    <!--GERMAN-->

                    <!-- </div> -->
                </div>
            </div> <!-- /.panel-body -->
        </div> <!-- /.panel-default -->
    </div> <!-- /.col6 -->
    <!-- ------------------------------- End map ------------------------------------------------------------------------------ -->
    <!-- ------------------------------- Panel left ------------------------------------------------------------------------------ -->
    <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
        <div class="panel panel-default">
            <div class="panel-body">
                <!-- ------------------------------- Draw areas ce first ----------------------------------------------------- -->
                <div class="hidden" id="draw_ce">
                    <h5 style="margin-bottom: 20px">Please, can you draw the areas in which you want to participate in
                        city participatory processes.
                    </h5>
                </div>
                <!-- ------------------------------- Draw areas ce first end ----------------------------------------------------- -->
                <!-- ------------------------------- Draw areas ce next ----------------------------------------------------- -->
               <div class="hidden" id="live_area">
                <h5 style="margin-top: 20px">
                    Do you live in that area?
                </h5>
                <div>
                    <label class="radio-inline">
                        <input type="radio" name="live" value="true"> Yes
                    </label>
                    <label class="radio-inline">
                        <input type="radio" name="live" value="false" checked="checked"> Not
                    </label>
                </div>
               </div>
                <div class="hidden" id="another_draw_ce">
                    <p style="margin-bottom: 20px"><b><h4>Great job!</h4></b></p>
                    <div id="change_name_group">Now you can draw another area where you want to be involve in
                        participatory processes, or click the
                        <button type="button" class="btn btn-primary btn-next" href="#" disabled>Next</button>
                        button on th map to continue.
                    </div>
                </div>
                <!-- ------------------------------- Draw areas ce next end----------------------------------------------------- -->
            <!-- ------------------------------- Questions ----------------------------------------------------- -->
            <div class="show" id="questions_done">
                <h5>We are almost finishing. Please, answer the following questions regarding Lisbon city.</h5>
                <hr style="width: 100%">
                <h5 style="margin-bottom: 20px; padding-top: 0px">
                    Civic engagement
                </h5>
                <div class="no-float">
                    <div>
                        <p class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="padding-left: 0px">In the last 12
                            months, have you joined together with other people members to address a common problem
                            or issue?</p>
                        <div class="col-md-12 col-sm-12 col-xs-12 col-lg-12"
                             style="padding-left: 5px; padding-right: 5px; margin-bottom: 20px">
                            <label class="radio-inline personal_radio" style="margin-top: -10px; font-size: 12px;">
                                <input type="radio" name="ce1" value="1"> 1
                                 Never
                            </label>
                            <label class="radio-inline"
                                   style="margin-top: -10px; margin-left: 10px; font-size: 12px">
                                <input type="radio" name="ce1" value="2"> 2
                            </label>
                            <label class="radio-inline"
                                   style="margin-top: -10px; margin-left: 10px; font-size: 12px">
                                <input type="radio" name="ce1" value="3"> 3
                            </label>
                            <label class="radio-inline"
                                   style="margin-top: -10px; margin-left: 10px; font-size: 12px">
                                <input type="radio" name="ce1" id="inlineRadio4" value="4"> 4
                            </label>
                            <label class="radio-inline"
                                   style="margin-top: -10px; margin-left: 10px; font-size: 12px">
                                <input type="radio" name="ce1" id="inlineRadio5" value="5"> 5
                                Every-day
                            </label>
                        </div>
                    </div>
                    <div class="no-float"></div>
                    <div>
                        <p class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="padding-left: 0px">In the last 12
                            months, have you talked with a local authority or governmental organization about common
                            problems?</p>
                        <div class="col-md-12 col-sm-12 col-xs-12 col-lg-12"
                             style="padding-left: 5px; padding-right: 5px; margin-bottom: 20px">
                            <label class="radio-inline personal_radio" style="margin-top: -10px; font-size: 12px;">
                                <input type="radio" name="ce2" value="1"> 1
                                 Never
                            </label>
                            <label class="radio-inline" style="margin-top: -10px; margin-left: 10px; font-size: 12px">
                                <input type="radio" name="ce2" value="2"> 2
                            </label>
                            <label class="radio-inline" style="margin-top: -10px; margin-left: 10px; font-size: 12px">
                                <input type="radio" name="ce2" value="3"> 3
                            </label>
                            <label class="radio-inline" style="margin-top: -10px; margin-left: 10px; font-size: 12px">
                                <input type="radio" name="ce2" value="4"> 4
                            </label>
                            <label class="radio-inline" style="margin-top: -10px; margin-left: 10px; font-size: 12px">
                                <input type="radio" name="ce2" value="5"> 5
                                Every-day
                            </label>
                        </div>
                    </div>
                    <div class="no-float"></div>
                    <div>
                        <p class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="padding-left: 0px">In the last 12
                            months, have you worked with a local authority or governmental organization to solve
                            common problems?</p>
                        <div class="col-md-12 col-sm-12 col-xs-12 col-lg-12"
                             style="padding-left: 5px; padding-right: 5px; margin-bottom: 20px">
                            <label class="radio-inline personal_radio" style="margin-top: -10px; font-size: 12px;">
                                <input type="radio" name="ce3" value="1"> 1
                                 Never
                            </label>
                            <label class="radio-inline" style="margin-top: -10px; margin-left: 10px; font-size: 12px">
                                <input type="radio" name="ce3" value="2"> 2
                            </label>
                            <label class="radio-inline" style="margin-top: -10px; margin-left: 10px; font-size: 12px">
                                <input type="radio" name="ce3" value="3"> 3
                            </label>
                            <label class="radio-inline" style="margin-top: -10px; margin-left: 10px; font-size: 12px">
                                <input type="radio" name="ce3" value="4"> 4
                            </label>
                            <label class="radio-inline" style="margin-top: -10px; margin-left: 10px; font-size: 12px">
                                <input type="radio" name="ce3" value="5"> 5
                                Every-day
                            </label>
                        </div>
                    </div>
                    <div class="no-float"></div>
                    <a type="button" class="btn btn-primary float-right display_questions  display_title" id="ce_done"
                       onclick="changeclass();">Next</a>
                </div>
                <!-- -------------------------------  End questions ----------------------------------------------------- -->
            </div> <!-- .col-6 -->
        </div> <!-- .panel-default -->
    </div> <!-- .panel-body -->
    <div class="no-float"></div>
    <!-- ------------------------------- End Panel left ------------------------------------------------------------------------ -->


    <!-- ------------------------------- Map visible xs ---------------------------------------------------------------------------------- -->
    <div class="visible-xs col-xs-12" style="padding: 0px; padding-top: 30px">
        <div class="panel panel-default">
            <div class="panel-body">
                <div id="map2" style="height:83vh; position: relative;">
                    <div style="position: absolute; top: 10px; left: 40px; z-index: 998">
                        <button class="btn btn-default btn-xs" id="draw_polyxs">
                            <span class="glyphicon glyphicon-pencil" aria-hidden="true"
                                  style="margin-right: 5px"></span> Start drawing
                        </button>
                        <button class="btn btn-default btn-xs" id="delete_polyxs">
                                <span class="glyphicon glyphicon-trash" aria-hidden="true"
                                      style="margin-right: 5px"></span>
                            Delete area
                        </button>
                    </div>
                    <a type="button" class="btn btn-primary finish-map pop" data-toggle="popover"
                       data-placement="top" title="Before finish"
                       data-content="Areas that have drawn, chooses the most important to you."
                       onclick="toggler('secondimage');" disabled>Next</a>
                </div> <!-- map -->
                <!-- <div class="custom_buttons_leaflet">
                    <button class="btn btn-default btn-xs" id="draw_polyxs" onclick="drawPolygon()">
                        <span class="glyphicon glyphicon-pencil" aria-hidden="true"
                              style="margin-right: 5px;"></span> Drawing
                    </button>
                    <button class="btn btn-default btn-xs" id="delete_polyxs">
                        <span class="glyphicon glyphicon-trash" aria-hidden="true"
                              style="margin-right: 5px"></span> Delete
                    </button>
                </div>
                <div id="map2" style="height:83vh"></div> -->
                <!-- Button finish -->
                <!-- <div class="col-xs-12 col-md-12 col-lg-12 col-sm-12" style="text-align: right;">
                  <a class="btn btn-primary finish-map" href="#">Next</a>
                </div> -->
            </div> <!-- /.panel-body -->
        </div> <!-- /.panel-default -->
    </div> <!-- /.col6 -->
    <!-- ------------------------------- End map ------------------------------------------------------------------------------ -->
</div> <!-- .container fluid -->


<script src="js/jquery-3.1.1.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/leaflet.js"></script>
<script src="js/leaflet-src.js"></script>
<script src="js/leaflet.draw.js"></script>
<script src="js/bootstrap-slider.js"></script>
<script src="js/functions_map3.js"></script>


<script src="src/edit/handler/Edit.Poly.js"></script>
<script src="src/edit/handler/Edit.SimpleShape.js"></script>
<script src="src/edit/handler/Edit.Circle.js"></script>
<script src="src/edit/handler/Edit.Rectangle.js"></script>

<script src="src/draw/handler/Draw.Feature.js"></script>
<script src="src/draw/handler/Draw.Polyline.js"></script>
<script src="src/draw/handler/Draw.Polygon.js"></script>
<script src="src/draw/handler/Draw.SimpleShape.js"></script>
<script src="src/draw/handler/Draw.Rectangle.js"></script>
<script src="src/draw/handler/Draw.Circle.js"></script>
<script src="src/draw/handler/Draw.Marker.js"></script>

<script src="src/ext/TouchEvents.js"></script>
<script src="src/ext/LatLngUtil.js"></script>
<script src="src/ext/GeometryUtil.js"></script>
<script src="src/ext/LineUtil.Intersect.js"></script>
<script src="src/ext/Polyline.Intersect.js"></script>
<script src="src/ext/Polygon.Intersect.js"></script>

<script src="src/Control.Draw.js"></script>
<script src="src/Tooltip.js"></script>
<script src="src/Toolbar.js"></script>

<script src="src/draw/DrawToolbar.js"></script>
<script src="src/edit/EditToolbar.js"></script>
<script src="src/edit/handler/EditToolbar.Edit.js"></script>
<script src="src/edit/handler/EditToolbar.Delete.js"></script>

<script src="js/API/lib.js"></script>

<script>
    $(document).ready(function () {
        startMapComponents();
        startAll();
    });
</script>


<script>
    var map, drawnItems, drawControl;
    var buttonDraw, buttonDelete;

    function startMapComponents() {
        zoommap = -100;

        function isElementInViewport(el) {
            if (typeof jQuery === "function" && el instanceof jQuery) {
                el = el[0];
            }
            var rect = el.getBoundingClientRect();
            return !((rect.top == 0) && (rect.left == 0) && (rect.bottom == 0) && (rect.right == 0));
        }


        // Big Map
        var map1 = L.map('map', {
            scrollWheelZoom: false,
        });
        map1.on('load', function (e) {
            if (isElementInViewport($('#map'))) {
                createAll(map1, $("#draw_poly"), $("#delete_poly"));
            }
        });
        map1.setView([38.7500, -9.1500], 12);

        // Small Map
        var mapxs = L.map('map2');
        mapxs.on('load', function (e) {
            if (isElementInViewport($('#map2'))) {
                createAll(mapxs, $("#draw_polyxs"), $("#delete_polyxs"));
            }
        });
        mapxs.setView([38.7500, -9.1500], 12);

        function createAll(rmap, bdraw, bdelete) {
            map = rmap;
            buttonDraw = bdraw;
            buttonDelete = bdelete;
            // add an OpenStreetMap tile layer
            L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
                // attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);
            // Customize button draw polygon - personal contribution
            var polygonDrawer = new L.Draw.Polyline(map);

            // Initialise the FeatureGroup to store editable layers
            drawnItems = new L.FeatureGroup();
            map.addLayer(drawnItems);

            // Initialise the draw control and pass it the FeatureGroup of editable layers
            drawControl = new L.Control.Draw({
                //position: 'topright',
                draw: {
                    polyline: false,
                    polygon: false,
                    rectangle: false,
                    circle: false,
                    marker: false
                },
                edit: {
                    featureGroup: drawnItems,
                    // Customize button delete polygon - personal contribution
                    remove: false,
                    // Edit polygon when you draw it - personal contribution
                    edit: false
                }
            });
            map.addControl(drawControl);

            map.on('draw:created', function (e) {
                var type = e.layerType, layer = e.layer;
                if (type === 'marker') {
                    layer.bindPopup('A popup!');
                }
                // Edit polygon when you draw it - personal contribution
                e.layer.editing.enable();
                drawnItems.addLayer(layer);
                drawnItems.setStyle({color: '#00ff00'})
//                zoommap = map.getZoom();
//                map.fitBounds(drawnItems.getBounds(), null);
                $(".finish-map").attr('disabled', false);
                $("#another_draw_ce").removeClass().addClass("show");
                $("#draw_ce").removeClass().addClass("hidden");
                $("#live_area").removeClass().addClass("show");
                buttonDelete.prop('disabled', false);


                var polygonData = {
                    type:"cea",
                    layer: L.geoJson(drawnItems.toGeoJSON()),
                    //,livingIn = input...
                };

                CE.push(polygonData);

                map.removeLayer(drawnItems);
                drawnItems = new L.FeatureGroup();
                map.addLayer(drawnItems);
                map.addLayer(polygonData.layer);

            });

            map.on('draw:edited', function (e) {
                var layers = e.layers;
                var countOfEditedLayers = 0;
                layers.eachLayer(function (layer) {
                    countOfEditedLayers++;
                });
                console.log("Edited " + countOfEditedLayers + " layers");
                //map.fitBounds(drawnItems.getBounds(), null);
            });

            // Customize button delete polygon - personal contribution
            buttonDelete.on('click', function () {
                drawnItems.clearLayers();
                $("#draw_ce").removeClass().addClass("show");
                $("#another_draw_ce").removeClass().addClass("hidden");
                $("#live_area").removeClass().addClass("hidden");
                buttonDelete.prop('disabled', true);
                if (CE.length > 0){
                    map.removeLayer(CE[CE.length-1].layer);
                    CE.pop();
                }
            });

            buttonDraw.on('click', function () {
                if ($("#live_area").is(":visible")){
                    CE[CE.length-1].livingIn = (($("input[name=live]:checked").val()) === 'true');
                }
                var polygonDrawer = new L.Draw.Polygon(map, drawControl);
                polygonDrawer.enable();
                $("#live_area").removeClass().addClass("hidden");
            });
        }
    }
</script>

</body>
</html>
